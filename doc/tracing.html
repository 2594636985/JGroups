<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>JGroups.Common API Overview</title>
</head>
<body bgcolor="white">

<p>
Provides classes (especially {@link JGroups.Common.Trace}) for
logging timestamped messages to files, streams, writers, and sockets at
differing levels of verbosity.
</p>

<p>
Log outputs are associated with a <i>module name</i> and a <i>trace
level</i>. A module name specifies a class name and optionally a method
name (see <a href="#modules">Module Names</a> below).
</p>

<p>
A trace level is an integer specifying a level of output verbosity. The
<code>Trace</code> class defines trace level constants such as
<code>DEBUG</code>, <code>WARN</code>, and <code>FATAL</code>. Messages
sent to an output are only printed if the trace level of the message is
greater than or equal to the trace level set for the output.
</p>

<p>
Outputs are flushed when an output is closed. Outputs may be set to
auto-flush after every call to <code>print</code>. By default,
auto-flushing is turned off. <em>Note</em>: there is currently no way to
assure that output is flushed when the program exits. It is the
programmer's responsibility to call <code>Trace.closeAllOutputs()</code> or
otherwise flush and close all outputs. As of Java 1.3, the
<code>Runtime.addShutdownHook</code> method allows us to register a thread
that could be used to flush and close all outputs.sed to flush and close all outputs. See code commented out
in <code>Trace.java</code>.
</p>

<p>
If a module is not associated with any output, then a default output is
used. The initial value of the default output is <code>null</code>.
Messages sent to a null output are ignored.
</p>

<a name="modules">
<h3>Module Names</h3>
</a>

<p>
A module name is a string used to associate a message with a particular
logging output. Module names should be of the form
<var>classname</var>[.<var>methodname</var>([<var>args...</var>])]]: a
class name optionally followed by a method name with parenthesis that
optionally contain arguments. Here are some examples of legal module names:
</p>

<ul>
<li><code>MyClass</code> (classname)</li>
<li><code>JGroups.Common.MyClass</code> (class names can be fully
  qualified)</li>
<li><code>MyClass.method()</code> (classname and method, no args)</li>
<li><code>MyClass.method(int, String)</code> (classname and method, with
  args)</li>
<li><code>MyClass.method</code> (legal, but this is a fully qualified class
  name because there are no parenthesis)</li>
</ul>

<p>
Currently, method arguments are always ignored. In the future, we may want
to be able to distinguish between methods with the same name and different
arguments (for example, "MyClass.method(int)" and "MyClass.method(String)".
</p>

<h3>Module Inheritance</h3>

<p>
When calling <code>Trace.print</code>, the first argument is a moduprint</code>, the first argument is a module name.
When looking for which output to use, <code>Trace</code> uses the
following set of rules. If no output is found (the returned output is
<code>null</code>), then nothing is printed.
</p>

<ol>

<li>If the module name contains no method name (there are no parenthesis),
look for the output associated with this module name. If found, return it.
Else, return the default output (initially <code>null</code>).</li>

<!--
<li><i>(Possibly in a future release)</i>Look for the output associated
with this module and method name, including arguments.</li>
-->

<li>Look for the output associated with this module and method name,
excluding arguments if any.</li>

<li>Strip off the method name and look for the output associated with the
class name.</li>

<li>Use the default output (initially <code>null</code>).

</ol>

<p>For example,
<pre><code>Trace.print("JChannel.Foo1()", Trace.FATAL, "ouch!");</code></pre>
would first look for "JChannel.Foo1()", then "JChannel", then use the
default output (which may be <code>null</code>, which means no output will
be produced).
<!--
<pre><code>Trace.print("JChannel.Foo1(int)", Trace.FATAL, "ouch!");</code></pre>
would first look for "JChannel.Foo1(int)", then "JChannel.Foo1()", then
"JChannel", then use stdout.
-->
</p>

<h3>Example Code</h3>

<p>
The following code shows how the rules above are used.
</p>

<pre>
<font color="blue">// Create outpu>

<pre>
<font color="blue">// Create output logging for all JChannel modules</font>
Trace.setOutput("JChannel", Trace.FATAL, "logfile");

<font color="blue">// Output to logfile</font>
Trace.println("JChannel", Trace.FATAL, "ouch!");

<font color="blue">// Not output (level is not FATAL)</font>
Trace.println("JChannel", Trace.DEBUG, "buggy?");

<font color="blue">// Both output to logfile because "JChannel" found.</font>
Trace.println("JChannel.Foo1()", Trace.FATAL, "waah");
Trace.println("JChannel.Foo2()", Trace.FATAL, "waah");

<font color="blue">// Send JChannel.Foo1() messages to a different logfile and set</font>
<font color="blue">// the trace level for Foo1() to INFO.</font>
Trace.setOutput("JChannel.Foo1()", Trace.INFO, "foo1_logfile");

<font color="blue">// These are output to logfile because "JChannel" log is still in</font>
<font color="blue">// effect for all "JChannel*" modules that are not "JChannel.Foo1()"</font>
Trace.println("JChannel", Trace.FATAL, "ouch!");
Trace.println("JChannel.Foo2()", Trace.FATAL, "ouch!");

<font color="blue">// Output to foo1_logfile because trace level FATAL &gt; INFO</font>
Trace.println("JChannel.Foo1()", Trace.FATAL, "ouch!");

<font color="blue">// Not output because trace level DEBUG &lt; INFO</font>
Trace.println("JChannel.Foo1()", Trace.DEBUG, "buggy?");

<font color="blue">// Reset trace level of all JChannel messages to DEBUG. Does not</font>
<font color="blue">// reset output file; oblue">// reset output file; output still goes to logfile. Does not affect</font>
<font color="blue">// "JChannel.Foo1()" output.</font>
Trace.setOutput("JChannel", Trace.DEBUG);

<font color="blue">// Now this gets output because we have reset the debug level.</font>
Trace.println("JChannel", Trace.DEBUG, "buggy?");

<font color="blue">// Flush and close output for "foo1_logfile". All messages printed</font>
<font color="blue">// for "JChannel.Foo1()" are now sent to the "JChannel" output</font>
<font color="blue">// logfile. The level is Trace.DEBUG because that's what it was</font>
<font color="blue">// already for "JChannel".</font>
Trace.closeOutput("JChannel.Foo1()");
</pre>

</body>
</html>
body>
</html>
